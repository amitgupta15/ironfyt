<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Log</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <form class="form-container" autocomplete="off">
      <div class="form-flex-group margin-bottom-15px">
        <label class="switch form-group-label">
          <input type="checkbox" id="duration-switch" />
          <span class="slider round"></span>
        </label>
        <div class="form-flex-group">
          <div class="form-input-group show-time-separator">
            <input type="number" class="form-input duration-input" name="wolog-duration-hours" id="wolog-duration-hours" min="0" max="240" value="${workoutlog.duration && workoutlog.duration.hours ? workoutlog.duration.hours : ''}" placeholder="H" disabled />
            <label for="wolog-duration-hours" class="form-label duration-label">H</label>
          </div>
          <div class="form-input-group show-time-separator">
            <input type="number" class="form-input duration-input" name="wolog-duration-minutes" id="wolog-duration-minutes" min="0" max="59" value="${workoutlog.duration && workoutlog.duration.minutes ? workoutlog.duration.minutes : ''}" placeholder="M" disabled />
            <label for="wolog-duration-minutes" class="form-label duration-label">M</label>
          </div>
          <div class="form-input-group">
            <input type="number" class="form-input duration-input" name="wolog-duration-seconds" id="wolog-duration-seconds" min="0" max="59" value="${workoutlog.duration && workoutlog.duration.seconds ? workoutlog.duration.seconds : ''}" placeholder="S" disabled />
            <label for="wolog-duration-seconds" class="form-label duration-label">S</label>
          </div>
        </div>
      </div>
      <div class="form-flex-group margin-bottom-15px">
        <label class="switch form-group-label">
          <input type="checkbox" id="rounds-switch" />
          <span class="slider round"></span>
        </label>
        <div class="form-flex-group">
          <div class="form-input-group">
            <input type="number" class="form-input rounds-input" name="wolog-rounds" id="wolog-rounds" value="" placeholder="Rounds" disabled />
            <label for="wolog-rounds" class="form-label rounds-label">Rounds</label>
          </div>
        </div>
      </div>
      <div class="form-flex-group">
        <label class="switch form-group-label">
          <input type="checkbox" id="exercise-switch" />
          <span class="slider round"></span>
        </label>
        <div class="form-flex-group">
          <div class="form-input-group">
            <input class="form-input wolog-exercise-input" name="wolog-exercise" id="wolog-exercise" placeholder="Record by Exercise, Reps & Load" disabled />
            <label for="wolog-exercise" class="form-label" id="wolog-exercise-input-label">Record Exercise, Reps & Load</label>
            <button type="button" id="wolog-exericse-add-btn" class="wolog-exericse-add-btn">Add</button>
            <div id="autocomplete-exercise-list" class="autocomplete-exercise-list"></div>
          </div>
        </div>
      </div>
    </form>
  </body>
  <script>
    function disableField(name) {
      name['disabled'] = true;
      name['value'] = '';
    }

    function enableField(name) {
      name['disabled'] = false;
    }

    function toggleDurationFields() {
      let durationSwitch = document.querySelector('#duration-switch');
      let hourInput = document.querySelector('#wolog-duration-hours');
      let minuteInput = document.querySelector('#wolog-duration-minutes');
      let secondInput = document.querySelector('#wolog-duration-seconds');
      if (durationSwitch.checked) {
        enableField(hourInput);
        enableField(minuteInput);
        enableField(secondInput);
      } else {
        disableField(hourInput);
        disableField(minuteInput);
        disableField(secondInput);
      }
    }
    function toggleRoundsFields() {
      let roundsSwitch = document.querySelector('#rounds-switch');
      let roundsInputField = document.querySelector('#wolog-rounds');
      if (roundsSwitch.checked) {
        enableField(roundsInputField);
      } else {
        disableField(roundsInputField);
      }
    }

    function toggleExerciseFields() {
      let exerciseSwitch = document.querySelector('#exercise-switch');
      let exerciseInputField = document.querySelector('#wolog-exercise');
      let exerciseInputFieldLabel = document.querySelector('#wolog-exercise-input-label');
      let exerciseAddButton = document.querySelector('#wolog-exericse-add-btn');

      if (exerciseSwitch.checked) {
        enableField(exerciseInputField);
        exerciseInputFieldLabel.innerHTML = 'Exercise Name';
        exerciseAddButton.style.display = 'block';
      } else {
        disableField(exerciseInputField);
        exerciseInputFieldLabel.innerHTML = 'Record Exercise, Reps & Load';
        exerciseAddButton.style.display = 'none';
      }
    }

    document.addEventListener('click', function (event) {
      if (event.target.id === 'duration-switch') {
        toggleDurationFields();
      }
      if (event.target.id === 'rounds-switch') {
        toggleRoundsFields();
      }
      if (event.target.id === 'exercise-switch') {
        toggleExerciseFields();
      }
    });

    let exercises = ['Deadlift', 'Overhead Squat', 'Overhead Lunges', 'Bench Press', 'Squat', 'Back Squat', 'Front Squat'];

    // Got the inspiration for the code from https://www.w3schools.com/howto/howto_js_autocomplete.asp

    /**
     * takes two arguments, the input field and the list of items to be used for auto complete
     * */
    let autocomplete = function (textField, list) {
      let autocompleteDiv = document.getElementById('autocomplete-exercise-list');
      // Execute the function when someone writes something in the input field
      textField.addEventListener('input', function (event) {
        //Capture the input value
        let textFieldValue = this.value;
        //Close any open lists of autocompleted values
        if (!textFieldValue) {
          //If no textfield value then clean the list
          autocompleteDiv.innerHTML = '';
          return false;
        }
        let autocompleteList = '';
        for (let i = 0; i < list.length; i++) {
          if (list[i].toLowerCase().includes(textFieldValue.toLowerCase())) {
            let subStringIndex = list[i].toLowerCase().indexOf(textFieldValue.toLowerCase());
            // Check if the first letter of the list items matches the input value or if 2 or more letters match anywhere in the list item
            if ((textFieldValue.length < 2 && subStringIndex === 0) || textFieldValue.length >= 2) {
              let stringToHighlight = list[i].substr(subStringIndex, textFieldValue.length);
              autocompleteList += `<div>${list[i].replace(stringToHighlight, `<strong>${stringToHighlight}</strong>`)}</div>`;
            }
          }
        }
        autocompleteDiv.innerHTML = autocompleteList;
      });
    };

    autocomplete(document.getElementById('wolog-exercise'), exercises);
  </script>
</html>
